
var IniteditMusic={recentObject:{recentAjax:null,response:null,},config:{showError:true,csrf:null,siteName:null,showSiteNameInTitle:true},recentMusic:{music:new Array(),fullScreenMusic:null,searchMusic:new Array(),getById:function(d){var b=this.music.length;for(var c=0;c<b;c++){var a=this.music[c];if(a.musicid==d){return a}}var b=this.searchMusic.length;for(var c=0;c<b;c++){var a=this.searchMusic[c];if(a.musicid==d){return a}}return false},getByIdAny:function(d){var b=this.music.length;for(var c=0;c<b;c++){var a=this.music[c];if(a.musicid==d){return a}}if(this.fullScreenMusic.musicid==d){return this.fullScreenMusic}var b=this.searchMusic.length;for(var c=0;c<b;c++){var a=this.searchMusic[c];if(a.musicid==d){return a}}return false}},init:function(){IniteditMusic.config.csrf=$("body").attr("data-csrf");IniteditMusic.config.siteName=$("body").attr("data-site");IniteditMusic.storage.init();$("a").not(".linkDefault").click(IniteditMusic.helper.anchorClick);IniteditMusic.helper.reloadPage();IniteditMusic.notification.init();IniteditMusic.helper.init();IniteditMusic.player.init();window.onbeforeunload=IniteditMusic.page.beforeUnload;$(window).resize(function(){var a=$(window).width();if(a>720){IniteditMusic.player.updateBottomMusicProgressContainer()}if(a>950){IniteditMusic.player.waveform.regenerate()}})},helper:{init:function(){window.onpopstate=function(a){IniteditMusic.helper.reloadPage()}},anchorClick:function(b){b.preventDefault();var a=$(this).attr("href");IniteditMusic.helper.loadNewPage(a)},loadNewPage:function(a){if(a[0]=="/"){a=a.substr(1)}if(a==""){a="home"}if(IniteditMusic.upload.music.uploadInfoAjax.isUploading()){IniteditMusic.upload.music.saveUploadState.init()}IniteditMusic.recentObject.recentAjax=$.ajax({type:"POST",url:"/ajax/"+a,data:{info:JSON.stringify({url:a})},dataType:"json",beforeSend:function(b){$("#mainProgressBar").show()},success:function(b){IniteditMusic.recentObject.response=b;IniteditMusic.helper.processDownloadedPage(b,a);$("#mainProgressBar").css("width",100+"%").delay(500).hide("fast",function(){$("#mainProgressBar").css("width",0+"%")})},failure:function(b){if(IniteditMusic.config.showError){$("body").append("<div>"+b+"</div>")}IniteditMusic.recentObject.response=b},error:function(b){if(IniteditMusic.config.showError){$("body").append("<div>"+b.responseText+"</div>")}console.log(b)},xhr:function(){var b=$.ajaxSettings.xhr();b.upload.onprogress=IniteditMusic.helper.updateProgress;b.onload=function(){console.log("DONE!")};return b}})},reloadPage:function(){var a=window.location.pathname;IniteditMusic.helper.loadNewPage(a)},updateProgress:function(a){if(a.lengthComputable){var b=a.loaded/a.total*100;console.log(b);$("#mainProgressBar").css("width",b*0.67+"%")}else{console.log("percentComplete")}},processDownloadedPage:function(b,a){if(IniteditMusic.config.showSiteNameInTitle){$("title").text(b.title+" - "+IniteditMusic.config.siteName)}else{$("title").text(b.title)}$("#main").html(b.data);$("#main a").not(".linkDefault").click(IniteditMusic.helper.anchorClick);IniteditMusic.helper.percessDownloadedMusicItem(b);if(a!=""){window.history.pushState("","","/"+a)}else{window.history.pushState("","","/")}if(IniteditMusic.upload.music.uploadInfoAjax.isUploading()&&a=="upload"){IniteditMusic.upload.music.restoreUploadUI()}window.scrollTo(0,0);IniteditMusic.helper.updateMetaTags(b)},percessDownloadedMusicItem:function(h,l){if(l==undefined){IniteditMusic.recentMusic.music=new Array();l=IniteditMusic.recentMusic.music}if(h.musicinfo!=undefined){var p=h.musicinfo.length;for(var d=0;d<p;d++){var b=h.musicinfo[d].music;var a=h.musicinfo[d].id;var e=b.length;var o=$("#musicItemContainer").prop("innerHTML");for(var g=0;g<e;g++){var n=b[g];l.push(n);var k=o;k=k.replace(/\{\{musicid\}\}/g,n.musicid);k=k.replace(/\{\{title\}\}/g,n.title);k=k.replace(/\{\{username\}\}/g,n.user.name);k=k.replace(/\{\{imagethumb\}\}/g,n.image.thumb);k=k.replace(/\{\{musicurl\}\}/g,n.musicurl);$("#"+a).append(k)}$("#main .stopPropagation").on("click",IniteditMusic.helper.stopPropagationAndPreventDefault);$("#main #"+a+" a").not(".linkDefault").click(IniteditMusic.helper.anchorClick)}}if(IniteditMusic.player.audio.current!=null){var c=IniteditMusic.player.audio.current;$(".musicPlayPauseButtonItem_"+c.musicid).show();if(IniteditMusic.player.isPlaying()){$(".musicPlayPauseButtonItem_"+c.musicid).css("background-image","url("+IniteditMusic.player.config.icon.pause+")")}else{$(".musicPlayPauseButtonItem_"+c.musicid).css("background-image","url("+IniteditMusic.player.config.icon.play+")")}}IniteditMusic.recentMusic.fullScreenMusic=null;if(h.isFullScreenMusic!=undefined){this.proccessDownloadedFullMusic(h)}},proccessDownloadedFullMusic:function(a){IniteditMusic.log(a);IniteditMusic.player.waveform.generate(a.music);IniteditMusic.recentMusic.fullScreenMusic=a.music;$("#fullMusicPlayPauseButtonItem_"+a.music.musicid).show();if(IniteditMusic.player.isPlaying()){if(a.music.musicid==IniteditMusic.player.audio.current.musicid){$("#fullMusicPlayPauseButtonItem_"+a.music.musicid).css("background-image","url("+IniteditMusic.player.config.icon.pause+")")}else{$("#fullMusicPlayPauseButtonItem_"+a.music.musicid).css("background-image","url("+IniteditMusic.player.config.icon.play+")")}}else{$("#fullMusicPlayPauseButtonItem_"+a.music.musicid).css("background-image","url("+IniteditMusic.player.config.icon.play+")")}},preventDefault:function(a){a.preventDefault()},stopPropagationAndPreventDefault:function(b){var a=b?b:window.event;if(a.stopPropagation){a.stopPropagation()}if(a.cancelBubble!=null){a.cancelBubble=true}b.preventDefault()},updateMetaTags:function(b){IniteditMusic.log(b);$(".metaTitle").attr("content",b.title);$(".metaDescription").attr("content",b.description);$(".metaURL").attr("content",window.location.href);$(".metaURLCanonical").attr("href",window.location.href);if(b.isFullScreenMusic!=undefined){$(".metaImage").attr("content",b.music.image.original);$(".metaDescription").attr("content",b.music.description)}else{var a=$(".siteButton").css("background-image");a=a.replace("url(","").replace(")","").replace(/\"/gi,"");$(".metaImage").attr("content",a)}}},log:function(a){if(window.console){console.log(a)}},account:{signup:function(){var g=$("#signupName").val();var c=$("#signupPass").val();var b=$("#signupPassConfirm").val();var a=$("#signupEmail").val();var d=/^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;if(!d.test(a)){$("#wrongpassword").show();$("#wrongpassword").html("Invalid Email ID.");return}if(g.length==0){$("#wrongpassword").show();$("#wrongpassword").html("User name is required.");return}if(c.length==0){$("#wrongpassword").show();$("#wrongpassword").html("Password is required.");return}if(b.length==0){$("#wrongpassword").show();$("#wrongpassword").html("Confirm Password is required.");return}else{if(c!==b){$("#wrongpassword").show();$("#wrongpassword").html("Password Didn't Match.");return}}$("#wrongpassword").hide();var e={username:g,password:c,confirmPassword:b,email:a};$.ajax({type:"POST",url:"/ajax/signup/create",data:{info:JSON.stringify(e)},dataType:"json",success:function(h){IniteditMusic.recentObject.response=h;if(h.code==1){IniteditMusic.notification.toast.addMessageBox(0,h.message);setTimeout(function(){IniteditMusic.helper.loadNewPage(h.nextPage)},2000)}else{$("#wrongpassword").show();$("#wrongpassword").html(h.message)}},failure:function(h){if(IniteditMusic.config.showError){$("body").append("<div>"+h+"</div>")}IniteditMusic.recentObject.response=h},error:function(h){if(IniteditMusic.config.showError){$("body").append("<div>"+h.responseText+"</div>")}console.log(h)}})},login:function(){var d=$("#loginName").val();var a=$("#loginPass").val();var c=$("#logincheckbox").is(":checked");if(d.length==0){$("#wrongpassword").show();$("#wrongpassword").html("User name is required.");return}if(a.length==0){$("#wrongpassword").show();$("#wrongpassword").html("Password is required.");return}$("#wrongpassword").hide();var b={username:d,password:a,rememberme:c};$.ajax({type:"POST",url:"/ajax/login/validate",data:{info:JSON.stringify(b)},dataType:"json",success:function(e){IniteditMusic.recentObject.response=e;if(e.code==1){IniteditMusic.notification.toast.addMessageBox(0,e.message);$(".settingMenuLoggedIn").show();$(".settingMenuLogIn").hide();$("#settingMenuUserName").attr("href",e.profileurl);setTimeout(function(){IniteditMusic.helper.loadNewPage(e.nextPage)},2000)}else{$("#wrongpassword").show();$("#wrongpassword").html(e.message)}},failure:function(e){if(IniteditMusic.config.showError){$("body").append("<div>"+e+"</div>")}IniteditMusic.recentObject.response=e},error:function(e){if(IniteditMusic.config.showError){$("body").append("<div>"+e.responseText+"</div>")}console.log(e)}})},logout:function(a){$.ajax({type:"POST",url:"/ajax/login/logout",data:{csrf:IniteditMusic.config.csrf},dataType:"json",success:function(b){IniteditMusic.recentObject.response=b;if(b.code==1){IniteditMusic.notification.toast.addMessageBox(0,b.message);$(".settingMenuLoggedIn").hide();$(".settingMenuLogIn").show();if(a){IniteditMusic.helper.reloadPage()}}else{IniteditMusic.notification.toast.addMessageBox(1,b.message)}},failure:function(b){if(IniteditMusic.config.showError){$("body").append("<div>"+b+"</div>")}IniteditMusic.recentObject.response=b},error:function(b){if(IniteditMusic.config.showError){$("body").append("<div>"+b.responseText+"</div>")}console.log(b)}})}},notification:{init:function(){this.toast.init()},toast:{init:function(){$("body").append("<div id='rightMessageBox' class='rightMessageBox'></div>")},addMessageBox:function(a,e){var g="messageBox_"+(new Date()).getTime()+Math.ceil(Math.random()*200);var c='<div class="messageBox '+((a===0)?"messageBoxGreen":"messageBoxRed")+'" id="'+g+'">                <ul class="hl">                    <li>'+e+'</li>                    <li class="close" onclick="IniteditMusic.notification.toast.closeMessageBox(\''+g+"')\">x</li>                </ul>            </div>";$("#rightMessageBox").prepend(c);var b={boxid:g};var d=IniteditMusic.notification.toast.showMessageBox.bind(b);setTimeout(d,0)},showMessageBox:function(){IniteditMusic.log(this);$("#"+this.boxid).css("opacity","1");f=IniteditMusic.notification.toast.hideMessageBox.bind(this);setTimeout(f,4000)},hideMessageBox:function(){$("#"+this.boxid).css("opacity","0");f=IniteditMusic.notification.toast.removeMessageBox.bind(this);setTimeout(f,500)},removeMessageBox:function(){$("#"+this.boxid).remove()},closeMessageBox:function(b){var a={boxid:b};f=IniteditMusic.notification.toast.hideMessageBox.bind(a);setTimeout(f,0)}}},upload:{music:{save:function(){},config:{isUploading:false},onChangeMusicInput:function(){if(!window.File||!window.FileReader||!window.FileList||!window.Blob){alert("Featured required for this operation is not available.\nTry Updataing Browser.");return}var a=$("#uploadMusicFileInput").prop("files");var m=$("#musicUploadContainer").prop("innerHTML");$("#musicUploadStepTwoMusicList").html("");for(var e=0;e<a.length;e++){var h=a[e];var d=h.name;var p=h.size;var j=m;var o=$("#musicUploadStepTwoMusicList > div").length;var c=d.lastIndexOf(".");var k=c>-1?d.substr(0,c):d;k=k.replace(/[^0-9a-z]/gi," ");k=k.replace(/\s+/g," ");j=j.replace(/\{\{title\}\}/g,k);j=j.replace(/\{\{tmpid\}\}/g,o);$("#musicUploadStepTwoMusicList").append(j);var l={extra:{fileIndex:e,tmpid:o},file:h};var g=IniteditMusic.upload.music.uploadSingleFile(l);l.uploadSingleFileAjax=g;var b={tmpid:o,uploadInfo:l,uploadSingleFileAjax:g,saveMusicAjax:null};IniteditMusic.upload.music.uploadInfoAjax.ajaxObject.push(b)}if(a.length>0){$("#musicUploadStepOne").hide();$("#musicUploadStepTwo").show();this.config.isUploading=true}$("#musicUploadStepTwoMusicList > .musicUploadSingleUIContainer:first-child .detail").slideDown()},toggleDetail:function(a){$("#musicDetail_"+a).slideToggle()},hideError:function(a){$("#musicUploadErrorContainer_"+a).slideUp()},showError:function(b,a){$("#musicUploadErrorContainer_"+b).slideDown();$("#musicUploadError_"+b).html(a)},previewImageReadURL:function(b){if(b.f&&b.f[0]){var a=new FileReader();a.onload=function(c){$("#"+b.id).attr("src",c.target.result)};a.readAsDataURL(b.f[0])}},previewImageReadURLBackground:function(b){if(b.f&&b.f[0]){var a=new FileReader();a.onload=function(c){$("#"+b.id).css("background-image","url("+c.target.result+")")};a.readAsDataURL(b.f[0])}},onChangeSelectedImage:function(b){var a={id:"selectedImageUploadImg_"+b,f:$("#selectedImageUploadInput_"+b).get(0).files};IniteditMusic.upload.music.saveUploadState.updateStateAppendImageFile(b,$("#selectedImageUploadInput_"+b).get(0).files);IniteditMusic.upload.music.previewImageReadURL(a)},uploadInfoAjax:{ajaxObject:new Array(),appendSaveUploadAjax:function(d,c){for(var b=0;b<this.ajaxObject.length;b++){var a=this.ajaxObject[b];if(a.tmpid==d){a.saveMusicAjax=c}}},cancelSingleUpload:function(c){for(var b=0;b<this.ajaxObject.length;b++){var a=this.ajaxObject[b];if(a.tmpid==c){a.uploadSingleFileAjax.abort();if(a.saveMusicAjax!=null){a.saveMusicAjax.abort()}}}},isUploading:function(){for(var b=0;b<this.ajaxObject.length;b++){var a=this.ajaxObject[b];if(a.uploadSingleFileAjax!=null){if(a.uploadSingleFileAjax.readyState!=4){return true}}}if(IniteditMusic.upload.music.uploadedInfo.length>0){return true}return false},isUploadingStarted:function(){return this.ajaxObject.length==0?false:true},isUploadingCompleted:function(){for(var b=0;b<this.ajaxObject.length;b++){var a=this.ajaxObject[b];if(a.uploadSingleFileAjax!=null){if(a.uploadSingleFileAjax.readyState!=4){return false}if(a.saveMusicAjax!=null){if(a.saveMusicAjax.readyState!=4){return false}}else{return false}}}return true},removeSingleUploadAjax:function(c){for(var b=0;b<this.ajaxObject.length;b++){var a=this.ajaxObject[b];if(a.tmpid==c){this.ajaxObject.splice(b,1);return}}}},uploadedInfo:new Array(),getUploadedInfo:function(c){for(var b=0;b<this.uploadedInfo.length;b++){var a=this.uploadedInfo[b];if(a.extra.tmpid==c){return a}}return false},removeUploadedInfo:function(c){for(var b=0;b<this.uploadedInfo.length;b++){var a=this.uploadedInfo[b];if(a.extra.tmpid==c){this.uploadedInfo.splice(b,1);return}}return false},uploadSingleFile:function(b){var a=new FormData();a.append("extra",JSON.stringify(b.extra));a.append("music",b.file);var c=$.ajax({url:"/ajax/upload/draftmusic",data:a,contentType:false,processData:false,type:"POST",dataType:"json",xhr:function(){var d=$.ajaxSettings.xhr();d.upload.onprogress=IniteditMusic.upload.music.updateSingalUploadProgress.bind(b);d.upload.onload=function(){console.log("DONE!")};return d},success:function(d){IniteditMusic.upload.music.uploadSingleFileSuccess(d)},failure:function(d){if(IniteditMusic.config.showError){$("body").append("<div>"+d+"</div>")}IniteditMusic.recentObject.response=d},error:function(d){if(IniteditMusic.config.showError){$("body").append("<div>"+d.responseText+"</div>")}console.log(d)}});return c},uploadSingleFileSuccess:function(a){IniteditMusic.recentObject.response=a;if(a.code==1){$("#uploadProgress_"+a.extra.tmpid).css("width","100%");IniteditMusic.upload.music.uploadedInfo.push(a)}else{IniteditMusic.upload.music.showError(a.extra.tmpid,a.message)}},updateSingalUploadProgress:function(a){if(a.lengthComputable){var b=a.loaded/a.total*100;$("#uploadProgress_"+this.extra.tmpid).css("width",b+"%")}else{}},saveMusic:function(b){var g=$("#uploadTitle_"+b).val();var m=$("#uploadTag_"+b).val();var k=$("#uploadDesription_"+b).val();var e=$("#selectedImageUploadInput_"+b).get(0);var c=$("#uploadPrivacy_"+b).is(":checked");var h=false;if(g==undefined||g==""){IniteditMusic.upload.music.showError(b,"Title is required.");return}if(m==undefined||m==""){IniteditMusic.upload.music.showError(b,"Tag is required.");return}if(k==""){}if((e.files&&e.files[0])){h=true}else{var l=IniteditMusic.upload.music.saveUploadState.getImageFile(b);if(l!=false){h=true}}var a=this.getUploadedInfo(b);if(a==false){IniteditMusic.notification.toast.addMessageBox(1,"Wait! Music is not uploaded yet.");return}var j={tmpid:b,title:g,tag:m,privacy:c,description:k,imageSelected:h,uploaded:a,tmpnumber:a.tmpnumber};var d=new FormData();d.append("extra",JSON.stringify(j));if(h){if(e.files&&e.files[0]){d.append("image",e.files[0])}else{var l=IniteditMusic.upload.music.saveUploadState.getImageFile(b);d.append("image",l)}}var i=$.ajax({url:"/ajax/upload/savemusic",data:d,contentType:false,processData:false,type:"POST",dataType:"json",xhr:function(){var n=$.ajaxSettings.xhr();n.upload.onprogress=IniteditMusic.upload.music.updateSingalSaveProgress.bind(j);n.upload.onload=IniteditMusic.upload.music.updateSingalSaveCompleted.bind(j);return n},success:function(n){IniteditMusic.recentObject.response=n;IniteditMusic.log(n);IniteditMusic.upload.music.saveMusicSuccess(n)},failure:function(n){if(IniteditMusic.config.showError){$("body").append("<div>"+n+"</div>")}IniteditMusic.recentObject.response=n},error:function(n){if(IniteditMusic.config.showError){$("body").append("<div>"+n.responseText+"</div>")}console.log(n)}});IniteditMusic.upload.music.uploadInfoAjax.appendSaveUploadAjax(b,i);IniteditMusic.upload.music.saveUploadState.updateSavedState(b,i)},saveMusicSuccess:function(a){if(a.code==1){var b=a.extra.tmpid;$("#uploadDisplayTitle_"+b).addClass("savedTitle");$("#uploadRemoveSingle_"+b).show();$("#uploadActionButtonContainer_"+b).slideUp();$("#musicUploadCoverInputContainer_"+b).hide();IniteditMusic.upload.music.hideError(b);if(a.messageShown==undefined){IniteditMusic.notification.toast.addMessageBox(0,a.message);a.messageShown=true}}else{$("#uploadSaveProgress_"+this.tmpid).hide();IniteditMusic.upload.music.showError(a.extra.tmpid,a.message)}IniteditMusic.upload.music.config.isUploading=IniteditMusic.upload.music.uploadInfoAjax.isUploading()},updateSingalSaveProgress:function(a){if(a.lengthComputable){$("#uploadSaveProgress_"+this.tmpid).show();var b=a.loaded/a.total*100;$("#uploadSaveProgress_"+this.tmpid).html(" Saving - "+b+"% ")}else{}},updateSingalSaveCompleted:function(a){$("#uploadSaveProgress_"+this.tmpid).show();$("#uploadSaveProgress_"+this.tmpid).html(" Saved ")},requestCancelSingalMusicUpload:function(a){$("#requestCancleContainer_"+a).show()},requestcancelSingalMusicUploadHide:function(a){$("#requestCancleContainer_"+a).hide()},cancelSingalMusicUpload:function(a){IniteditMusic.upload.music.uploadInfoAjax.cancelSingleUpload(a);$("#requestCancleContainer_"+a).fadeOut();$("#uploadRemoveSingle_"+a).hide();$("#uploadActionButtonContainer_"+a).slideUp();$("#uploadDisplayTitle_"+a).addClass("errorTitle");$("#uploadProgress_"+a).addClass("uploadProgressError");$("#uploadProgress_"+a).css("width","100%");setTimeout(function(){IniteditMusic.upload.music.removeSingleUpload(a)},2000)},saveUploadState:{info:new Array(),init:function(){if(this.info==0){this.saveState()}},saveState:function(){var d=IniteditMusic.upload.music.uploadInfoAjax.ajaxObject.length;for(var a=0;a<d;a++){var c={};var e=IniteditMusic.upload.music.uploadInfoAjax.ajaxObject[a].uploadInfo;c.saveMusicAjax=IniteditMusic.upload.music.uploadInfoAjax.ajaxObject[a].saveMusicAjax;c.uploadSingleFileAjax=IniteditMusic.upload.music.uploadInfoAjax.ajaxObject[a].uploadSingleFileAjax;c.fileIndex=e.extra.fileIndex;c.tmpid=e.extra.tmpid;c.musicfile=e.file;c.title=$("#uploadTitle_"+c.tmpid).val();c.tag=$("#uploadTag_"+c.tmpid).val();c.description=$("#uploadDesription_"+c.tmpid).val();c.privacy=$("#uploadPrivacy_"+c.tmpid).is(":checked");c.isImageFileSelected=false;var b=$("#selectedImageUploadInput_"+c.tmpid).prop("files");if(b!=undefined&&b.length==1){c.isImageFileSelected=true;c.imagefile=b[0]}else{c.isImageFileSelected=false;c.imagefile=null}this.info.push(c)}},updateState:function(){var d=this.info.length;for(var a=0;a<d;a++){var c=this.info[a];c.title=$("#uploadTitle_"+c.tmpid).val();c.tag=$("#uploadTag_"+c.tmpid).val();c.description=$("#uploadDesription_"+c.tmpid).val();c.privacy=$("#uploadPrivacy_"+c.tmpid).is(":checked");var b=$("#selectedImageUploadInput_"+c.tmpid).prop("files");if(b!=undefined&&b.length==1){c.isImageFileSelected=true;c.imagefile=b[0]}}},updateStateAppendImageFile:function(e,d){var c=this.info.length;for(var a=0;a<c;a++){var b=this.info[a];if(b.tmpid==a){if(d!=undefined&&d.length==1){b.isImageFileSelected=true;b.imagefile=d[0]}}}},getImageFile:function(d){var c=this.info.length;for(var a=0;a<c;a++){var b=this.info[a];if(b.tmpid==a){if(b.isImageFileSelected){return b.imagefile}else{return false}}}return false},updateSavedState:function(g,e){var d=this.info.length;for(var a=0;a<d;a++){var c=this.info[a];if(c.tmpid==g){c.title=$("#uploadTitle_"+c.tmpid).val();c.tag=$("#uploadTag_"+c.tmpid).val();c.description=$("#uploadDesription_"+c.tmpid).val();c.privacy=$("#uploadPrivacy_"+c.tmpid).is(":checked");var b=$("#selectedImageUploadInput_"+c.tmpid).prop("files");if(b!=undefined&&b.length==1){c.isImageFileSelected=true;c.imagefile=b[0]}c.saveMusicAjax=e}}},removeSavedState:function(d){var c=this.info.length;for(var a=0;a<c;a++){var b=this.info[a];if(b.tmpid==d){this.info.splice(a,1)}}}},restoreUploadUI:function(){var j=$("#musicUploadContainer").prop("innerHTML");var a=this.saveUploadState.info.length;for(var d=0;d<a;d++){var c=this.saveUploadState.info[d];var e=c.musicfile;var g=j;var k=c.tmpid;var h=c.title;h=h.replace(/[^0-9a-z]/gi," ");h=h.replace(/\s+/g," ");g=g.replace(/\{\{title\}\}/g,h);g=g.replace(/\{\{tmpid\}\}/g,k);$("#musicUploadStepTwoMusicList").append(g);$("#uploadTag_"+k).val(c.tag);$("#uploadDesription_"+k).val(c.description);if(c.privacy){}else{$("#uploadPrivatePrivacy_".tmpid).attr("checked","checked")}var b={id:"selectedImageUploadImg_"+k,f:new Array(c.imagefile)};this.previewImageReadURL(b);if(c.uploadSingleFileAjax.readyState==4){IniteditMusic.upload.music.uploadSingleFileSuccess(c.uploadSingleFileAjax.responseJSON)}if(c.saveMusicAjax!=null){if(c.saveMusicAjax.readyState==4){IniteditMusic.upload.music.saveMusicSuccess(c.saveMusicAjax.responseJSON)}}}if(a>0){$("#musicUploadStepOne").hide();$("#musicUploadStepTwo").show();$("#musicUploadStepTwoMusicList > .musicUploadSingleUIContainer:first-child .detail").slideDown()}},removeSingleUpload:function(b){$("#musicUploadSingleUIContainer_"+b).slideUp();this.uploadInfoAjax.removeSingleUploadAjax(b);this.saveUploadState.removeSavedState(b);this.removeUploadedInfo(b);if(!IniteditMusic.upload.music.uploadInfoAjax.isUploading()){$("#musicUploadStepOne").show();$("#musicUploadStepTwo").hide()}var a=this.saveUploadState.info.length;if(a>0){$("#musicUploadStepOne").hide();$("#musicUploadStepTwo").show();$("#musicUploadStepTwoMusicList > .musicUploadSingleUIContainer:first-child .detail").slideDown()}},edit:{image:null,editAjax:null,onClickSaveEdit:function(i){var h=$("#editTitleInput").val();var a=$("#editTagInput").val();var d=$("#editDescriptionInput").val();var b=$("#editMusicPrivacy").is(":checked");$("#editError").show();if(h.length==0){$("#editError").html("Title is required");return}if(a.length==0){$("#editError").html("Tag is required");return}$("#editError").hide();var c=false;if(IniteditMusic.upload.music.edit.image!=null){c=true}var g={title:h,tag:a,description:d,privacy:b,musicid:i,imageSelected:c};var e=new FormData();e.append("extra",JSON.stringify(g));if(c){e.append("image",IniteditMusic.upload.music.edit.image)}IniteditMusic.upload.music.edit.editAjax=$.ajax({url:"/ajax/upload/editmusic",data:e,contentType:false,processData:false,type:"POST",dataType:"json",success:function(j){if(j.code==1){IniteditMusic.notification.toast.addMessageBox(0,j.message)}else{IniteditMusic.notification.toast.addMessageBox(1,j.message)}IniteditMusic.log(j)},failure:function(j){if(IniteditMusic.config.showError){$("body").append("<div>"+j+"</div>")}IniteditMusic.recentObject.response=j},error:function(j){if(IniteditMusic.config.showError){$("body").append("<div>"+j.responseText+"</div>")}console.log(j)}})},onChangeImageFile:function(){var a=$("#editImageInput").prop("files");if(a!=undefined&&a[0]!=undefined){IniteditMusic.upload.music.edit.image=a[0];var b={id:"editImageContainer",f:a};IniteditMusic.upload.music.previewImageReadURLBackground(b)}},onClickShowDeleteMenu:function(){$("#confirmDeleteContainer").fadeIn()},onClickHideDeleteMenu:function(){$("#confirmDeleteContainer").fadeOut()},onClickDeleteMusic:function(b){var a={musicid:b};$.ajax({type:"POST",url:"/ajax/upload/deletemusic",data:{extra:JSON.stringify(a)},dataType:"json",success:function(c){IniteditMusic.recentObject.response=c;if(c.code==1){IniteditMusic.notification.toast.addMessageBox(0,c.message);if(c.nextpage!=undefined){setTimeout(function(){IniteditMusic.helper.loadNewPage(c.nextpage)},1000)}}else{IniteditMusic.notification.toast.addMessageBox(1,c.message)}IniteditMusic.log(c)},failure:function(c){if(IniteditMusic.config.showError){$("body").append("<div>"+c+"</div>")}IniteditMusic.recentObject.response=c},error:function(c){if(IniteditMusic.config.showError){$("body").append("<div>"+c.responseText+"</div>")}console.log(c)}})}}}},player:{config:{volume:{init:50,min:0,max:100},track:{startedSkiping:false},time:{forwardSkipSecond:30,backwardSkipSecond:10},icon:{play:"/public/images/play-icon.svg",pause:"/public/images/pause-icon.svg",loading:"/public/images/loader.gif",repeat:"/public/images/repeat-icon.svg",repeathighlight:"/public/images/repeat-icon-highlight.svg",volume:{high:"/public/images/volume-high-icon.svg",medium:"/public/images/volume-medium-icon.svg",low:"/public/images/volume-low-icon.svg",mute:"/public/images/mute-icon.svg"}},repeat:false},init:function(){IniteditMusic.player.config.repeat=IniteditMusic.storage.local.getRepeat();IniteditMusic.player.config.volume.init=IniteditMusic.storage.local.getVolume();this.updateRepeatUI();this.audio.init();this.sliders.init()},sliders:{init:function(){var a=IniteditMusic.player.config.volume.max-IniteditMusic.player.config.volume.init;$("#bottomMusicVolumeCircle").css("top",a);$("#bottomMusicVolumeProgress").css("height",a+"px");if(IniteditMusic.player.config.volume.init==0){$("#bottomVolumeButton").css("background-image","url("+IniteditMusic.player.config.icon.volume.mute+")")}else{if(IniteditMusic.player.config.volume.init<30){$("#bottomVolumeButton").css("background-image","url("+IniteditMusic.player.config.icon.volume.low+")")}else{if(IniteditMusic.player.config.volume.init<70){$("#bottomVolumeButton").css("background-image","url("+IniteditMusic.player.config.icon.volume.medium+")")}else{$("#bottomVolumeButton").css("background-image","url("+IniteditMusic.player.config.icon.volume.high+")")}}}},volume:function(){var b=$("#bottomMusicVolumeInput").val();var a=(IniteditMusic.player.config.volume.max-parseInt(b))/IniteditMusic.player.config.volume.max;var b=parseInt(b);$("#bottomMusicVolumeCircle").css("top",b);$("#bottomMusicVolumeProgress").css("height",b+"px");if(a==0){$("#bottomVolumeButton").css("background-image","url("+IniteditMusic.player.config.icon.volume.mute+")")}else{if(a*100<30){$("#bottomVolumeButton").css("background-image","url("+IniteditMusic.player.config.icon.volume.low+")")}else{if(a*100<70){$("#bottomVolumeButton").css("background-image","url("+IniteditMusic.player.config.icon.volume.medium+")")}else{$("#bottomVolumeButton").css("background-image","url("+IniteditMusic.player.config.icon.volume.high+")")}}}IniteditMusic.player.audio.audioObject.volume=a},volumeDone:function(){var b=$("#bottomMusicVolumeInput").val();var a=(IniteditMusic.player.config.volume.max-parseInt(b))/IniteditMusic.player.config.volume.max;IniteditMusic.storage.local.setVolume(a)},track:function(){var a=$("#bottomMusicTrackInput").val();var a=parseInt(a);$("#bottomMusicTrackCircle").css("left",a+"%");$("#bottomMusicTrackProgress").css("width",a+"%");IniteditMusic.player.config.track.startedSkiping=true},trackDone:function(){IniteditMusic.player.config.track.startedSkiping=false;var a=$("#bottomMusicTrackInput").val();var a=parseInt(a);IniteditMusic.player.audio.skipTimeBy(a)}},volume:{bottomToggle:function(){$("#bottomVolumeChangeContainer").slideToggle(200)}},play:function(a){this.audio.current=a;this.audio.play(a);$("#bottomMusicTitle").html(a.title);$("#bottomMusicImage").css("background-image","url("+a.image.thumb+")");$("#bottomPlayingMusicLink").prop("href",a.musicurl);$("#bottomMusicUserName").html(a.user.name);$("#bottomPlayPauseButton").css("background-image","url("+IniteditMusic.player.config.icon.loading+")");$("#bottomPlayerContainer").slideDown("fast",function(){setTimeout(function(){$("#footer").css("margin-bottom",$("#bottomPlayerContainer").outerHeight()+"px")},50)});$(".musicPlayPauseButtonItem_"+a.musicid).show();this.nextAndPreviousButtonCheck()},nextAndPreviousButtonCheck:function(){if(this.audio.playlist!=null){var b=this.audio.current;var a=this.audio.playlist.indexOf(b);if(a==0){$("#bottomPreviousButton").prop("disabled",true)}else{$("#bottomPreviousButton").prop("disabled",false)}if(a==this.audio.playlist.length-1){$("#bottomNextButton").prop("disabled",true)}else{$("#bottomNextButton").prop("disabled",false)}}else{$("#bottomPreviousButton").prop("disabled",true);$("#bottomNextButton").prop("disabled",true)}},pause:function(){this.audio.pause()},resume:function(){this.audio.resume()},toggle:function(){if(this.isPlaying()){this.audio.pause();$("#bottomPlayPauseButton").css("background-image","url("+IniteditMusic.player.config.icon.play+")");$(".musicPlayPauseButtonItem_"+IniteditMusic.player.audio.current.musicid).css("background-image","url("+IniteditMusic.player.config.icon.play+")");if(IniteditMusic.recentMusic.fullScreenMusic!=null){if(IniteditMusic.recentMusic.fullScreenMusic.musicid==IniteditMusic.player.audio.current.musicid){$("#fullMusicPlayPauseButtonItem_"+IniteditMusic.player.audio.current.musicid).css("background-image","url("+IniteditMusic.player.config.icon.play+")")}}}else{this.audio.resume();$("#bottomPlayPauseButton").css("background-image","url("+IniteditMusic.player.config.icon.pause+")");$(".musicPlayPauseButtonItem_"+IniteditMusic.player.audio.current.musicid).css("background-image","url("+IniteditMusic.player.config.icon.pause+")");if(IniteditMusic.recentMusic.fullScreenMusic!=null){if(IniteditMusic.recentMusic.fullScreenMusic.musicid==IniteditMusic.player.audio.current.musicid){$("#fullMusicPlayPauseButtonItem_"+IniteditMusic.player.audio.current.musicid).css("background-image","url("+IniteditMusic.player.config.icon.pause+")")}}}},isPlaying:function(){return !this.audio.audioObject.paused},onClickAddToCurrentPlaylist:function(c){var a=IniteditMusic.recentMusic.getByIdAny(c);if(IniteditMusic.player.audio.playlist!=null){var b=IniteditMusic.player.audio.playlist.indexOf(a);if(b>=0){}else{IniteditMusic.player.audio.playlist.push(a)}}else{if(IniteditMusic.player.audio.current==null){if(IniteditMusic.player.audio.playlist==null){IniteditMusic.player.audio.playlist=new Array()}IniteditMusic.player.audio.playlist.push(a);IniteditMusic.player.play(a)}else{if(IniteditMusic.player.audio.current==a){if(IniteditMusic.player.audio.playlist==null){IniteditMusic.player.audio.playlist=new Array()}IniteditMusic.player.audio.playlist.push(a)}else{if(IniteditMusic.player.audio.playlist==null){IniteditMusic.player.audio.playlist=new Array()}IniteditMusic.player.audio.playlist.push(a)}}}var b=IniteditMusic.player.audio.playlist.indexOf(a);if(b>=0){IniteditMusic.notification.toast.addMessageBox(0,"Added.")}},audio:{audioObject:new Audio(),current:null,playlist:null,init:function(){IniteditMusic.player.audio.audioObject.volume=IniteditMusic.player.config.volume.init/IniteditMusic.player.config.volume.max;this.audioObject.addEventListener("timeupdate",this.updateAudioTime,false);this.audioObject.addEventListener("playing",this.audioStartedPlaying,false);this.audioObject.addEventListener("pause",this.audioPausedPlaying,false);this.audioObject.addEventListener("ended",this.audioEnded,false);this.audioObject.addEventListener("waiting",this.audioWaitingPlaying,false);this.audioObject.addEventListener("stalled",this.audioStalledPlaying,false);this.audioObject.addEventListener("error",this.audioError,false)},play:function(a){this.audioObject.src=a.track.original;this.audioObject.load();this.audioObject.play()},pause:function(){this.audioObject.pause()},resume:function(){this.audioObject.play()},skipTimeBy:function(a){var b=(this.audioObject.duration/100)*a;this.audioObject.currentTime=b},updateAudioTime:function(){var c,b,d;b=(IniteditMusic.player.audio.audioObject.currentTime/IniteditMusic.player.audio.audioObject.duration)*100;if(!isNaN(IniteditMusic.player.audio.audioObject.currentTime)){c=IniteditMusic.player.audio.secondsToHms(IniteditMusic.player.audio.audioObject.currentTime)}else{c="0:00"}if(!isNaN(IniteditMusic.player.audio.audioObject.duration)){d=IniteditMusic.player.audio.secondsToHms(IniteditMusic.player.audio.audioObject.duration)}else{d="0:00"}$("#bottomPlayedTime").text(c);$("#bottomTotalTime").text(d);if(!IniteditMusic.player.config.track.startedSkiping){$("#bottomMusicTrackProgress").css("width",b+"%");$("#bottomMusicTrackCircle").css("left",b+"%");var a=IniteditMusic.player.audio.current;$("#fullScreenWaveformCanvasPlayedContainer_"+a.musicid).css("width",b+"%")}},secondsToHms:function(e){e=Number(e);var c=Math.floor(e/3600);var a=Math.floor(e%3600/60);var b=Math.floor(e%3600%60);return((c>0?c+":"+(a<10?"0":""):"")+a+":"+(b<10?"0":"")+b)},audioStartedPlaying:function(){$("#bottomPlayPauseButton").css("background-image","url("+IniteditMusic.player.config.icon.pause+")");$(".musicPlayPauseButtonItem_"+IniteditMusic.player.audio.current.musicid).css("background-image","url("+IniteditMusic.player.config.icon.pause+")");if(IniteditMusic.recentMusic.fullScreenMusic!=null){if(IniteditMusic.recentMusic.fullScreenMusic.musicid==IniteditMusic.player.audio.current.musicid){$("#fullMusicPlayPauseButtonItem_"+IniteditMusic.player.audio.current.musicid).css("background-image","url("+IniteditMusic.player.config.icon.pause+")")}}},audioPausedPlaying:function(){},audioEnded:function(){IniteditMusic.music.viewCount(IniteditMusic.player.audio.current);IniteditMusic.player.next();$("#bottomPlayPauseButton").css("background-image","url("+IniteditMusic.player.config.icon.play+")");$(".musicPlayPauseButtonItem_"+IniteditMusic.player.audio.current.musicid).css("background-image","url("+IniteditMusic.player.config.icon.play+")");if(IniteditMusic.recentMusic.fullScreenMusic!=null){if(IniteditMusic.recentMusic.fullScreenMusic.musicid==IniteditMusic.player.audio.current.musicid){$("#fullMusicPlayPauseButtonItem_"+IniteditMusic.player.audio.current.musicid).css("background-image","url("+IniteditMusic.player.config.icon.play+")")}}},audioWaitingPlaying:function(){$("#bottomPlayPauseButton").css("background-image","url("+IniteditMusic.player.config.icon.loading+")");$(".musicPlayPauseButtonItem_"+IniteditMusic.player.audio.current.musicid).css("background-image","url("+IniteditMusic.player.config.icon.loading+")");if(IniteditMusic.recentMusic.fullScreenMusic!=null){if(IniteditMusic.recentMusic.fullScreenMusic.musicid==IniteditMusic.player.audio.current.musicid){$("#fullMusicPlayPauseButtonItem_"+IniteditMusic.player.audio.current.musicid).css("background-image","url("+IniteditMusic.player.config.icon.loading+")")}}},audioStalledPlaying:function(){$("#bottomPlayPauseButton").css("background-image","url("+IniteditMusic.player.config.icon.play+")");$(".musicPlayPauseButtonItem_"+IniteditMusic.player.audio.current.musicid).css("background-image","url("+IniteditMusic.player.config.icon.play+")");if(IniteditMusic.recentMusic.fullScreenMusic!=null){if(IniteditMusic.recentMusic.fullScreenMusic.musicid==IniteditMusic.player.audio.current.musicid){$("#fullMusicPlayPauseButtonItem_"+IniteditMusic.player.audio.current.musicid).css("background-image","url("+IniteditMusic.player.config.icon.play+")")}}},audioError:function(a){IniteditMusic.notification.toast.addMessageBox(1,"Music Not Found.")},getNext:function(){for(var d=0;d<this.playlist.length-1;d++){var a=this.playlist[d];if(a.musicid==this.current.musicid){return this.playlist[d+1]}}if(IniteditMusic.player.config.repeat){if(this.playlist!=null){var b=this.playlist.length;var c=this.playlist[b-1];if(c.musicid==IniteditMusic.player.audio.current.musicid){return this.playlist[0]}}}return false},getPrevious:function(){for(var b=0;b<this.playlist.length;b++){var a=this.playlist[b];if(a.musicid==this.current.musicid){if(b==0){return false}else{return this.playlist[b-1]}}}return false}},toggleSetting:function(a){$(".musicSettingItem_"+a).slideToggle("fast")},showOnMouseEnter:function(b){var a=IniteditMusic.recentMusic.getById(b);if(a!==false){$(".musicPlayPauseButtonItem_"+b).show()}},hideOnMouseLeave:function(b){var a=IniteditMusic.recentMusic.getById(b);if(a!==false){if(IniteditMusic.player.audio.current==null){$(".musicPlayPauseButtonItem_"+b).hide()}else{if((a.musicid!=IniteditMusic.player.audio.current.musicid)){$(".musicPlayPauseButtonItem_"+b).hide()}}}},toggleMusicOnMouseClick:function(c){var a=IniteditMusic.recentMusic.getById(c);IniteditMusic.player.audio.playlist=IniteditMusic.recentMusic.music;if(a!==false){if(IniteditMusic.player.audio.current==null){IniteditMusic.player.play(a)}else{if(a.musicid==IniteditMusic.player.audio.current.musicid){IniteditMusic.player.toggle()}else{var b=IniteditMusic.player.audio.current;$("#fullScreenWaveformCanvasPlayedContainer_"+b.musicid).css("width",0+"%");$(".musicPlayPauseButtonItem_"+IniteditMusic.player.audio.current.musicid).css("background-image","url("+IniteditMusic.player.config.icon.play+")");$(".musicPlayPauseButtonItem_"+IniteditMusic.player.audio.current.musicid).hide();IniteditMusic.player.play(a)}}if(IniteditMusic.recentMusic.fullScreenMusic!=null){if(IniteditMusic.recentMusic.fullScreenMusic.musicid!=IniteditMusic.player.audio.current.musicid){$(".fullMusicPlayPauseButtonItem_"+IniteditMusic.recentMusic.fullScreenMusic.musicid).css("background-image","url("+IniteditMusic.player.config.icon.play+")")}}}this.updateBottomMusicProgressContainer()},updateBottomMusicProgressContainer:function(){var b=0;$(".bottomPlayer > *").not(".bottomMusicTimeContainer").each(function(){b+=$(this).width()});var a=$(".bottomMusicTimeContainer >li:first-child").width()+$(".bottomMusicTimeContainer >li:last-child").width();var c=$(".bottomPlayer").width()-1;$(".bottomMusicProgressContainer").css("min-width",parseInt((c-b-a))+"px")},showPlaylistOnClick:function(){if(!$("#bottomPlatlistContainer").is(":visible")){setTimeout(function(){$(window).on("click",IniteditMusic.player.hidePlaylistOnClickShortcut);$("#bottomPlatlistContainer").on("click",IniteditMusic.player.onClickStopPropagation)},0)}$("#bottomPlatlistContainer").slideDown();this.generateBottomPlaylist(true)},onClickStopPropagation:function(a){a.stopPropagation()},hidePlaylistOnClick:function(){IniteditMusic.log("hidePlaylistOnClick");$("#bottomPlatlistContainer").slideUp()},hidePlaylistOnClickShortcut:function(){$(window).off("click",IniteditMusic.player.hidePlaylistOnClickShortcut);$("#bottomPlatlistContainer").off("click",IniteditMusic.player.onClickStopPropagation);IniteditMusic.log("hidePlaylistOnClickShortcut");$("#bottomPlatlistContainer").slideUp()},playFromPlaylistOnClick:function(a){this.toggleMusicOnMouseClick(a);this.generateBottomPlaylist()},generateBottomPlaylist:function(a){var b=IniteditMusic.player.audio.playlist;if(b==null){var n="<p class='bottomEmptyPlaylist'>Playlist is empty.</p>";$("#bottomPlatlistItemContainer").html(n);return}var d=b.length;var k=$("#bottomPlaylistItemTemplateContainer").prop("innerHTML");$("#bottomPlatlistItemContainer").html("");for(var e=0;e<d;e++){var j=b[e];var g=k;g=g.replace(/\{\{musicid\}\}/g,j.musicid);g=g.replace(/\{\{title\}\}/g,j.title);g=g.replace(/\{\{username\}\}/g,j.user.name);g=g.replace(/\{\{imagethumb\}\}/g,j.image.thumb);$("#bottomPlatlistItemContainer").append(g)}if(d>0){var c=IniteditMusic.player.audio.current;$("#bottomPlaylistItem_"+c.musicid).addClass("highlight");if(a){var l=$("#bottomPlatlistItemContainer");var h=$("#bottomPlaylistItem_"+c.musicid);l.scrollTop(l.scrollTop()+h.position().top-l.height()/2-h.height()/2)}}else{$("#bottomPlatlistItemContainer").html("laylist is empty")}},next:function(){var a=IniteditMusic.player.audio.getNext();IniteditMusic.player.toggleMusicOnMouseClick(a.musicid)},previous:function(){var a=IniteditMusic.player.audio.getPrevious();IniteditMusic.player.toggleMusicOnMouseClick(a.musicid)},waveform:{config:{defaultType:2,music:null},generateBackup:function(g){var h=$("#fullScreenWaveformCanvas").get(0);var c=$("#fullScreenWaveformCanvasPlayed").get(0);var b=$("#fullScreenWaveformCanvasSeek").get(0);var k=h.getContext("2d");var i=b.getContext("2d");var e=c.getContext("2d");var a=$("#fullScreenWaveformCanvas").width();var j=$("#fullScreenWaveformCanvas").height();$("#fullScreenWaveformCanvas").prop("width",a);$("#fullScreenWaveformCanvas").prop("height",j);$("#fullScreenWaveformCanvasPlayed").prop("width",a).css("width",a+"px");$("#fullScreenWaveformCanvasPlayed").prop("height",j).css("height",j+"px");$("#fullScreenWaveformCanvasSeek").prop("width",a).css("width",a+"px");$("#fullScreenWaveformCanvasSeek").prop("height",j).css("height",j+"px");var d=new Image();d.onload=function(){k.drawImage(d,0,0,d.naturalWidth,d.naturalHeight,0,0,a,j);var m=k.getImageData(0,0,a,j);for(var l=0;l<m.data.length;l+=4){if(m.data[l]!=0){m.data[l]=120}if(m.data[l+1]!=0){m.data[l+1]=255}if(m.data[l+2]!=0){m.data[l+2]=0}}i.putImageData(m,0,0);var m=k.getImageData(0,0,a,j);for(var l=0;l<m.data.length;l+=4){if(m.data[l]!=0){m.data[l]=255}if(m.data[l+1]!=0){m.data[l+1]=120}if(m.data[l+2]!=0){m.data[l+2]=0}}e.putImageData(m,0,0)};d.src=g.image.waveform},generate:function(b){this.config.music=b;var a=IniteditMusic.storage.local.getWaveformType();if(a==1){IniteditMusic.player.waveform.generateNormal(b)}else{if(a==2){IniteditMusic.player.waveform.generateThumb(b)}}},regenerate:function(){if(this.config.music!=null){this.generate(this.config.music)}},generateNormal:function(g){var h=$("#fullScreenWaveformCanvas").get(0);var c=$("#fullScreenWaveformCanvasPlayed").get(0);var b=$("#fullScreenWaveformCanvasSeek").get(0);var k=h.getContext("2d");var i=b.getContext("2d");var e=c.getContext("2d");var a=$("#fullScreenWaveformCanvas").width();var j=$("#fullScreenWaveformCanvas").height();$("#fullScreenWaveformCanvas").prop("width",a);$("#fullScreenWaveformCanvas").prop("height",j);$("#fullScreenWaveformCanvasPlayed").prop("width",a).css("width",a+"px");$("#fullScreenWaveformCanvasPlayed").prop("height",j).css("height",j+"px");$("#fullScreenWaveformCanvasSeek").prop("width",a).css("width",a+"px");$("#fullScreenWaveformCanvasSeek").prop("height",j).css("height",j+"px");var d=new Image();d.onload=function(){k.drawImage(d,0,0,d.naturalWidth,d.naturalHeight,0,0,a,j);var m=k.getImageData(0,0,a,j);for(var l=0;l<m.data.length;l+=4){if(m.data[l]!=0){m.data[l]=120}if(m.data[l+1]!=0){m.data[l+1]=255}if(m.data[l+2]!=0){m.data[l+2]=0}}i.putImageData(m,0,0);var m=k.getImageData(0,0,a,j);for(var l=0;l<m.data.length;l+=4){if(m.data[l]!=0){m.data[l]=255}if(m.data[l+1]!=0){m.data[l+1]=120}if(m.data[l+2]!=0){m.data[l+2]=0}}e.putImageData(m,0,0)};d.src=g.image.waveform},generateThumb:function(g){var h=$("#fullScreenWaveformCanvas").get(0);var c=$("#fullScreenWaveformCanvasPlayed").get(0);var b=$("#fullScreenWaveformCanvasSeek").get(0);var i=$("#fullScreenWaveformCanvasThumb").get(0);var m=h.getContext("2d");var j=b.getContext("2d");var e=c.getContext("2d");var l=i.getContext("2d");var a=$("#fullScreenWaveformCanvas").width();var k=$("#fullScreenWaveformCanvas").height();$("#fullScreenWaveformCanvas").prop("width",a);$("#fullScreenWaveformCanvas").prop("height",k);$("#fullScreenWaveformCanvasPlayed").prop("width",a).css("width",a+"px");$("#fullScreenWaveformCanvasPlayed").prop("height",k).css("height",k+"px");$("#fullScreenWaveformCanvasSeek").prop("width",a).css("width",a+"px");$("#fullScreenWaveformCanvasSeek").prop("height",k).css("height",k+"px");$("#fullScreenWaveformCanvasThumb").prop("width",a).css("width",a+"px");$("#fullScreenWaveformCanvasThumb").prop("height",k).css("height",k+"px");var d=new Image();d.onload=function(){m.drawImage(d,0,0,d.naturalWidth,d.naturalHeight,0,0,a,k);l.drawImage(n,0,0,n.naturalWidth,n.naturalHeight,0,0,a,k);var r=m.getImageData(0,0,a,k);var p=l.getImageData(0,0,a,k);for(var o=0;o<r.data.length;o+=4){var q=0.34*p.data[o]+0.5*p.data[o]+0.16*p.data[o];if(r.data[o]!=0){r.data[o+3]=255;r.data[o]=q}if(r.data[o+1]!=0){r.data[o+3]=255;r.data[o+1]=q}if(r.data[o+2]!=0){r.data[o+3]=255;r.data[o+2]=q}}j.putImageData(r,0,0);var r=m.getImageData(0,0,a,k);for(var o=0;o<r.data.length;o+=4){if(r.data[o]!=0){r.data[o]=p.data[o];r.data[o+3]=255}if(r.data[o+1]!=0){r.data[o+1]=p.data[o+1];r.data[o+3]=255}if(r.data[o+2]!=0){r.data[o+2]=p.data[o+2];r.data[o+3]=255}}e.putImageData(r,0,0)};var n=new Image();n.onload=function(){d.src=g.image.waveform};IniteditMusic.log(g);n.src=g.image.original},showSeekBar:function(h){var b=IniteditMusic.player.audio.current;if(b!=null){var d=$("#fullMusicWaveformContainer_"+b.musicid).offset();var g=$("#fullScreenWaveformCanvas").width();if(d!=undefined){var a=(h.pageX-d.left);var c=(a/g)*100;$("#fullScreenWaveformCanvasSeekContainer_"+b.musicid).css("width",c+"%")}}},hideSeekBar:function(b){var a=IniteditMusic.player.audio.current;if(a!=null){$("#fullScreenWaveformCanvasSeekContainer_"+a.musicid).css("width",0+"%")}},seekOnClick:function(h){var b=IniteditMusic.player.audio.current;if(b!=null){var d=$("#fullMusicWaveformContainer_"+b.musicid).offset();var g=$("#fullScreenWaveformCanvas").width();if(d!=undefined){var a=(h.pageX-d.left);var c=(a/g)*100;IniteditMusic.player.audio.skipTimeBy(c)}}}},playlist:{bottom:{onDragStartedMusicItem:function(a,b){a.dataTransfer.setData("id",b);IniteditMusic.log("LOG - "+b)},allowDropMusicItem:function(a){a.preventDefault()},onDropMusicItem:function(i,b){i.preventDefault();var j=i.dataTransfer.getData("id");IniteditMusic.log(j+" - "+b);if(IniteditMusic.player.audio.playlist==null){IniteditMusic.player.audio.playlist=new Array()}var d=this.getByID(j);var a=this.getByID(b);if(d==false){this.addMusicItemIntoPlaylistAfter(j,a)}else{var e=IniteditMusic.player.audio.playlist.indexOf(d);var c=IniteditMusic.player.audio.playlist.indexOf(a);var g=IniteditMusic.player.audio.playlist[e];var h=IniteditMusic.player.audio.playlist.length;if(e<c){IniteditMusic.player.audio.playlist.splice(c+1,0,d);IniteditMusic.player.audio.playlist.splice(e,1)}else{IniteditMusic.player.audio.playlist.splice(c,0,d);IniteditMusic.player.audio.playlist.splice(e+1,1)}}IniteditMusic.player.generateBottomPlaylist()},onMenuButtonDropMusicItem:function(e){e.preventDefault();var d=e.dataTransfer.getData("id");if(IniteditMusic.player.audio.playlist==null){IniteditMusic.player.audio.playlist=new Array()}var c=IniteditMusic.recentMusic.getByIdAny(d);var a=IniteditMusic.player.audio.playlist.indexOf(c);var b=IniteditMusic.player.audio.playlist.length;if(c&&a<0){IniteditMusic.player.audio.playlist.push(c);IniteditMusic.notification.toast.addMessageBox(0,"Added to playlist");IniteditMusic.player.generateBottomPlaylist()}else{}},addMusicItemIntoPlaylistAfter:function(d,c){var a=IniteditMusic.recentMusic.getByIdAny(d);var b=IniteditMusic.player.audio.playlist.indexOf(c);IniteditMusic.player.audio.playlist.splice(b+1,0,a)},getByID:function(d){var b=IniteditMusic.player.audio.playlist.length;for(var c=0;c<b;c++){var a=IniteditMusic.player.audio.playlist[c];if(a.musicid==d){return a}}return false}}},onClickRepeatToggle:function(){IniteditMusic.player.config.repeat=!IniteditMusic.player.config.repeat;IniteditMusic.storage.local.setRepeat(IniteditMusic.player.config.repeat);this.updateRepeatUI()},updateRepeatUI:function(){var a=null;if(IniteditMusic.player.config.repeat){a=IniteditMusic.player.config.icon.repeathighlight}else{a=IniteditMusic.player.config.icon.repeat}$("#bottomRepeatButton").css("background-image","url("+a+")")}},playlist:{showAddToPlaylist:function(a){$("#addToPlaylistContainer").fadeIn("fast",function(){$("#main").hide()});$(window).on("keyup",this.hideAddToPlaylistFullScreenShortcut);IniteditMusic.recentObject.recentAjax=$.ajax({type:"POST",url:"/ajax/playlist/add",data:{info:JSON.stringify({music:a})},dataType:"json",success:function(b){IniteditMusic.recentObject.response=b;$("#addToPlaylistContainer #addToPlaylist").html(b.data);$("#addToPlaylistContainer #addToPlaylist a").on("click",IniteditMusic.helper.anchorClick);if($("#addToPlaylistContainer #addToPlaylist .playlistItem").length==0){IniteditMusic.playlist.showAddToPlaylistNewContainer()}else{IniteditMusic.playlist.showAddToPlaylistAddContainer()}},failure:function(b){if(IniteditMusic.config.showError){$("body").append("<div>"+b+"</div>")}IniteditMusic.recentObject.response=b},error:function(b){if(IniteditMusic.config.showError){$("body").append("<div>"+b.responseText+"</div>")}console.log(b)}})},showAddToPlaylistFullScreen:function(a){this.showAddToPlaylist(IniteditMusic.recentMusic.fullScreenMusic)},hideAddToPlaylistFullScreen:function(){$("#main").show();$("#addToPlaylistContainer").fadeOut()},hideAddToPlaylistFullScreenShortcut:function(a){if(a.keyCode==27){IniteditMusic.playlist.hideAddToPlaylistFullScreen();$(window).off("keyup",this.hideAddToPlaylistFullScreenShortcut)}},createNewPlaylist:function(b){var d=$("#newPlaylistName").val();var a=$("#playlistPrivacy").is(":checked");var c={playlist:d,privacy:a,music:b};IniteditMusic.recentObject.recentAjax=$.ajax({type:"POST",url:"/ajax/playlist/create",data:{info:JSON.stringify(c)},dataType:"json",success:function(e){IniteditMusic.recentObject.response=e;if(e.code==1){IniteditMusic.playlist.hideAddToPlaylistFullScreen();IniteditMusic.notification.toast.addMessageBox(0,e.message)}else{$("#addNewplaylistError").html(e.message).slideDown()}},failure:function(e){if(IniteditMusic.config.showError){$("body").append("<div>"+e+"</div>")}IniteditMusic.recentObject.response=e},error:function(e){if(IniteditMusic.config.showError){$("body").append("<div>"+e.responseText+"</div>")}console.log(e)}})},onClickCreateNewPlaylistFullScreen:function(b){var a=IniteditMusic.recentMusic.getByIdAny(b);$("#addNewplaylistError").slideUp();this.createNewPlaylist(a)},showAddToPlaylistNewContainer:function(){$("#addToPlaylistNewContainer").show();$("#addToPlaylistAddContainer").hide();$("#addToPlaylistNewContainerMenu").addClass("highlight");$("#addToPlaylistAddContainerMenu").removeClass("highlight")},showAddToPlaylistAddContainer:function(){$("#addToPlaylistNewContainer").hide().removeClass("highlight");$("#addToPlaylistAddContainer").show().addClass("highlight");$("#addToPlaylistNewContainerMenu").removeClass("highlight");$("#addToPlaylistAddContainerMenu").addClass("highlight")},addToPlaylist:function(b,c,a){IniteditMusic.recentObject.recentAjax=$.ajax({type:"POST",url:"/ajax/playlist/addtoplaylist",data:{info:JSON.stringify({music:b,playlist:c,url:a})},dataType:"json",success:function(d){IniteditMusic.recentObject.response=d;if(d.code==1){$("#addButtonPlaylist_"+a+"_"+b.musicid).hide();$("#removeButtonPlaylist_"+a+"_"+b.musicid).show()}else{$("#addToPlaylistError").html(d.message).slideDown()}},failure:function(d){if(IniteditMusic.config.showError){$("body").append("<div>"+d+"</div>")}IniteditMusic.recentObject.response=d},error:function(d){if(IniteditMusic.config.showError){$("body").append("<div>"+d.responseText+"</div>")}console.log(d)}})},onClickAddToPlaylistFullScreen:function(d,c,b){$("#addToPlaylistError").slideUp();var a=IniteditMusic.recentMusic.getByIdAny(d);this.addToPlaylist(a,c,b)},removeFromPlaylist:function(b,c,a){IniteditMusic.recentObject.recentAjax=$.ajax({type:"POST",url:"/ajax/playlist/removefromplaylist",data:{info:JSON.stringify({music:b,playlist:c,url:a})},dataType:"json",success:function(d){IniteditMusic.recentObject.response=d;if(d.code==1){$("#addButtonPlaylist_"+a+"_"+b.musicid).show();$("#removeButtonPlaylist_"+a+"_"+b.musicid).hide()}else{$("#addToPlaylistError").html(d.message).slideDown()}},failure:function(d){if(IniteditMusic.config.showError){$("body").append("<div>"+d+"</div>")}IniteditMusic.recentObject.response=d},error:function(d){if(IniteditMusic.config.showError){$("body").append("<div>"+d.responseText+"</div>")}console.log(d)}})},onClickRemoveFromPlaylistFullScreen:function(d,c,b){$("#addToPlaylistError").slideUp();var a=IniteditMusic.recentMusic.getByIdAny(d);this.removeFromPlaylist(a,c,b)},onClickItemShowAddToPlatlist:function(b){var a=IniteditMusic.recentMusic.getByIdAny(b);this.showAddToPlaylist(a)},startAnimation:function(){var c=$(".playlistBackgroundScroll img");if(c.length<6){return}var e=c.get(0);var b=$(e);var a=b.width();var d=6.6667*a;b.animate({marginLeft:"-"+a+"px"},{duration:d,complete:function(){$(this).css("margin-left",0);$(".playlistBackgroundScroll").append(this);IniteditMusic.playlist.startAnimation()}})}},music:{like:{likeMusic:function(a){IniteditMusic.recentObject.recentAjax=$.ajax({type:"POST",url:"/ajax/music/like",data:{info:JSON.stringify({music:a})},dataType:"json",beforeSend:function(){$("#musiclike_"+a.musicid).hide();$("#musicliked_"+a.musicid).show()},success:function(b){IniteditMusic.recentObject.response=b;if(b.code==1){$("#musiclike_"+a.musicid).hide();$("#musicliked_"+a.musicid).show()}else{IniteditMusic.notification.toast.addMessageBox(1,b.message);$("#musiclike_"+a.musicid).show();$("#musicliked_"+a.musicid).hide()}},failure:function(b){if(IniteditMusic.config.showError){$("body").append("<div>"+b+"</div>")}IniteditMusic.recentObject.response=b},error:function(b){if(IniteditMusic.config.showError){$("body").append("<div>"+b.responseText+"</div>")}$("#musiclike_"+a.musicid).show();$("#musicliked_"+a.musicid).hide()}})},onClickLikeMusic:function(b){var a=IniteditMusic.recentMusic.getByIdAny(b);this.likeMusic(a)},unlikeMusic:function(a){IniteditMusic.recentObject.recentAjax=$.ajax({type:"POST",url:"/ajax/music/unlike",data:{info:JSON.stringify({music:a})},dataType:"json",beforeSend:function(){$("#musiclike_"+a.musicid).show();$("#musicliked_"+a.musicid).hide()},success:function(b){IniteditMusic.recentObject.response=b;if(b.code==1){$("#musiclike_"+a.musicid).show();$("#musicliked_"+a.musicid).hide()}else{IniteditMusic.notification.toast.addMessageBox(1,b.message);$("#musiclike_"+a.musicid).hide();$("#musicliked_"+a.musicid).show()}},failure:function(b){if(IniteditMusic.config.showError){$("body").append("<div>"+b+"</div>")}IniteditMusic.recentObject.response=b},error:function(b){if(IniteditMusic.config.showError){$("body").append("<div>"+b.responseText+"</div>")}$("#musiclike_"+a.musicid).hide();$("#musicliked_"+a.musicid).show()}})},onClickUnlikeMusic:function(b){var a=IniteditMusic.recentMusic.getByIdAny(b);this.unlikeMusic(a)},},viewCount:function(a){IniteditMusic.recentObject.recentAjax=$.ajax({type:"POST",url:"/ajax/music/viewCount",data:{info:JSON.stringify({music:a})},dataType:"json",success:function(b){IniteditMusic.recentObject.response=b},failure:function(b){if(IniteditMusic.config.showError){$("body").append("<div>"+b+"</div>")}IniteditMusic.recentObject.response=b},error:function(b){if(IniteditMusic.config.showError){$("body").append("<div>"+b.responseText+"</div>")}}})},share:{config:{twitter:"https://twitter.com/share?url=",google:"https://plus.google.com/share?url="},showShareDialog:function(c){var b=window.location.protocol+"//"+window.location.host;$("#shareDialogBoxContainer").fadeIn();var a=IniteditMusic.recentMusic.getByIdAny(c);$("#twitterShare").prop("href",this.config.twitter+encodeURIComponent(b+a.musicurl));$("#googleShare").prop("href",this.config.google+b+a.musicurl);$(window).on("keyup",this.hideShareDialogShortcut)},hideShareDialog:function(){$("#shareDialogBoxContainer").fadeOut()},hideShareDialogShortcut:function(a){if(a.keyCode==27){IniteditMusic.music.share.hideShareDialog();$(window).off("keyup",this.hideShareDialogShortcut)}},},privacy:{onClickShowFullScreenPrivacy:function(){$("#fullMusicChangePrivacyBox").slideToggle()},changeFullMusicPrivacy:function(b,a){IniteditMusic.recentObject.recentAjax=$.ajax({type:"POST",url:"/ajax/music/changeprivacy",data:{info:JSON.stringify({music:b,privacy:a})},dataType:"json",success:function(c){IniteditMusic.recentObject.response=c;if(c.code==1){IniteditMusic.notification.toast.addMessageBox(0,c.message)}else{IniteditMusic.notification.toast.addMessageBox(1,c.message)}},failure:function(c){if(IniteditMusic.config.showError){$("body").append("<div>"+c+"</div>")}IniteditMusic.recentObject.response=c},error:function(c){if(IniteditMusic.config.showError){$("body").append("<div>"+c.responseText+"</div>")}$("#musiclike_"+b.musicid).show();$("#musicliked_"+b.musicid).hide()}})},onChangeFullMusicPrivacy:function(c){var a=IniteditMusic.recentMusic.getByIdAny(c);var b=$("#fullMusicPrivacySelect").val();this.changeFullMusicPrivacy(a,b)}}},user:{upload:{config:{profileimage:null,coverImage:null,saveProfileImageAjax:null,saveCoverImageAjax:null},profile:function(){if(this.config.profileimage==null){return}var a=new FormData();a.append("image",this.config.profileimage);this.config.saveProfileImageAjax=$.ajax({url:"/ajax/upload/userprofile",data:a,contentType:false,processData:false,type:"POST",dataType:"json",success:function(b){IniteditMusic.recentObject.response=b;IniteditMusic.log(b);if(b.code==1){$("#userProfileImage").attr("data-img",b.image);$("#userProfileImage").attr("src",b.image);IniteditMusic.user.upload.config.profileimage=null;$("#profileImageActionContainer").slideUp()}else{IniteditMusic.notification.toast.addMessageBox(1,b.message)}},failure:function(b){if(IniteditMusic.config.showError){$("body").append("<div>"+b+"</div>")}IniteditMusic.recentObject.response=b},error:function(b){if(IniteditMusic.config.showError){$("body").append("<div>"+b.responseText+"</div>")}console.log(b)},abort:function(){var b=$("#userProfileImage").attr("data-img");$("#userProfileImage").attr("src",b);this.config.profileimage=null;$("#profileImageActionContainer").slideUp()}})},onChangeProfile:function(){IniteditMusic.log(this);var b=$("#userProfileImageInput").prop("files");if(b&&b[0]){var a={id:"userProfileImage",f:b};IniteditMusic.upload.music.previewImageReadURL(a);this.config.profileimage=b[0];$("#profileImageActionContainer").slideDown()}},onCancelProfile:function(){var a=$("#userProfileImage").attr("data-img");$("#userProfileImage").attr("src",a);this.config.profileimage=null;$("#profileImageActionContainer").slideUp();if(this.config.saveProfileImageAjax!=null){this.config.saveProfileImageAjax.abort()}},onSaveProfile:function(){this.profile()},cover:function(){if(IniteditMusic.user.upload.config.coverImage==null){return}var a=new FormData();a.append("image",this.config.coverImage);this.config.saveCoverImageAjax=$.ajax({url:"/ajax/upload/usercover",data:a,contentType:false,processData:false,type:"POST",dataType:"json",success:function(b){IniteditMusic.recentObject.response=b;IniteditMusic.log(b);if(b.code==1){$("#userCoverImage").attr("data-img",b.image);$("#userCoverImage").css("background-image","url("+b.image+")");IniteditMusic.user.upload.config.coverImage=null;$("#coverImageActionContainer").slideUp()}else{IniteditMusic.notification.toast.addMessageBox(1,b.message)}},failure:function(b){if(IniteditMusic.config.showError){$("body").append("<div>"+b+"</div>")}IniteditMusic.recentObject.response=b},error:function(b){if(IniteditMusic.config.showError){$("body").append("<div>"+b.responseText+"</div>")}console.log(b)},abort:function(){var b=$("#userCoverImage").attr("data-img");$("#userCoverImage").css("background-image","url("+b+")");this.config.profileimage=null;$("#coverImageActionContainer").slideUp()}})},onChangeCover:function(){IniteditMusic.log(this);var b=$("#userCoverImageInput").prop("files");if(b&&b[0]){var a={id:"userCoverImage",f:b};IniteditMusic.upload.music.previewImageReadURLBackground(a);this.config.coverImage=b[0];$("#coverImageActionContainer").slideDown()}},onCancelCover:function(){var a=$("#userCoverImage").attr("data-img");$("#userCoverImage").css("background-image","url("+a+")");this.config.coverImage=null;$("#coverImageActionContainer").slideUp();if(this.config.saveCoverImageAjax!=null){this.config.saveCoverImageAjax.abort()}},onSaveCover:function(){this.cover()}},playlist:{menu:{showMenu:function(a){$("#userPlaylistMenu_"+a).slideToggle();$("#userPlaylistDeleteMenu_"+a).fadeOut();$("#userPlaylistPrivacyMenu_"+a).fadeOut()},hideMenuShortcut:function(b){var a=$("#userPlaylistMenu_"+this);if(!a.is(b.target)&&a.has(b.target).length===0){a.slideUp();$(document).unbind("mouseup",IniteditMusic.user.playlist.menu.hideMenuShortcut.bind(this))}},showDeleteMenu:function(a){$("#userPlaylistDeleteMenu_"+a).fadeIn()},hideDeleteMenu:function(a){$("#userPlaylistDeleteMenu_"+a).fadeOut()},showPrivacyMenu:function(a){$("#userPlaylistPrivacyMenu_"+a).fadeIn()},hidePrivacyMenu:function(a){$("#userPlaylistPrivacyMenu_"+a).fadeOut()},deletePlaylist:function(b){var a={playlist:b};$.ajax({type:"POST",url:"/ajax/playlist/delete",data:{info:JSON.stringify(a)},dataType:"json",success:function(c){IniteditMusic.recentObject.response=c;if(c.code==1){$("#userPlaylistItemContainer_"+c.playlist).slideUp("fast",function(){$("#userPlaylistItemContainer_"+c.playlist).remove()});if($("#userPlaylistItemContainer").length==0){IniteditMusic.helper.reloadPage()}}else{IniteditMusic.notification.toast.addMessageBox(1,c.message)}},failure:function(c){if(IniteditMusic.config.showError){$("body").append("<div>"+c+"</div>")}IniteditMusic.recentObject.response=c},error:function(c){if(IniteditMusic.config.showError){$("body").append("<div>"+c.responseText+"</div>")}console.log(c)}})},onClickDeletePlaylist:function(a){this.deletePlaylist(a)},changePrivacyPlaylist:function(c,a){var b={playlist:c,privacy:a};IniteditMusic.log(b);$.ajax({type:"POST",url:"/ajax/playlist/changeprivacy",data:{info:JSON.stringify(b)},dataType:"json",success:function(d){IniteditMusic.recentObject.response=d;if(d.code==1){IniteditMusic.notification.toast.addMessageBox(0,d.message)}else{IniteditMusic.notification.toast.addMessageBox(1,d.message)}},failure:function(d){if(IniteditMusic.config.showError){$("body").append("<div>"+d+"</div>")}IniteditMusic.recentObject.response=d},error:function(d){if(IniteditMusic.config.showError){$("body").append("<div>"+d.responseText+"</div>")}console.log(d)}})},onClickChangePrivacyPlaylist:function(b){var a=$("#userPlaylistPrivacy_"+b).val();this.changePrivacyPlaylist(b,a)},}}},page:{beforeUnload:function(a){if(!IniteditMusic.upload.music.uploadInfoAjax.isUploadingCompleted()){a=a||window.event;if(a){a.returnValue="Upload Operation is Pending"}return"Upload Operation is Pending"}},fullScreen:{toggleMusic:function(){if(IniteditMusic.player.audio.current==null){this.startFullScreenMusic()}else{if(IniteditMusic.recentMusic.fullScreenMusic.musicid!=IniteditMusic.player.audio.current.musicid){$(".musicPlayPauseButtonItem_"+IniteditMusic.player.audio.current.musicid).hide();this.startFullScreenMusic()}else{IniteditMusic.player.toggle()}}},startFullScreenMusic:function(){IniteditMusic.player.play(IniteditMusic.recentMusic.fullScreenMusic)},onClickShowWavformMenu:function(){$("#waveformTypeContainer").slideToggle("fast")},setWaveformType:function(a){IniteditMusic.storage.local.setWaveformType(a);IniteditMusic.player.waveform.regenerate();IniteditMusic.notification.toast.addMessageBox(0,"Changed");$("#waveformTypeContainer").slideUp("fast")}},home:{slider:{config:{sliderInterval:null,sliderStayTime:3000},init:function(){clearInterval(IniteditMusic.page.home.slider.config.sliderInterval);var e=$("#topHomeSlider .homeSlider > .sliderItem").length;$("#topHomeSlider .homeSlider").css("width",e*100+"%");$("#topHomeSlider .homeSlider > .sliderItem").css("width",(100/e)+"%");$("#topHomeSlider .homeSlider > .sliderItem").each(function(g){$(this).attr("data-sliderid",g)});var d="";for(var c=0;c<e;c++){d+="<span class='sliderCircle' data-circleid='"+c+"' onclick='IniteditMusic.page.home.slider.sliderMoveAt("+c+")'></span>"}var b="<div class='sliderCircleContainer'>"+d+"</div>";$("#topHomeSlider").append(b);var a=$("#topHomeSlider .sliderCircleContainer").width();$(".sliderCircleContainer").css("margin-left",-(a/2)+"px");$("#topHomeSlider .sliderCircleContainer .sliderCircle:first-child").addClass("highlight");IniteditMusic.page.home.slider.config.sliderInterval=setTimeout(IniteditMusic.page.home.slider.sliderMove,IniteditMusic.page.home.slider.config.sliderStayTime)},sliderMove:function(d){var e=$("#topHomeSlider .homeSlider > .sliderItem").length;var c=$($("#topHomeSlider .homeSlider > .sliderItem").get(0));var b=c.attr("data-sliderid");b=parseInt(b);$("#topHomeSlider .sliderCircleContainer .sliderCircle").removeClass("highlight");if(b!=(e-1)+""){$($("#topHomeSlider .sliderCircleContainer .sliderCircle").get(b)).next().addClass("highlight")}else{$($("#topHomeSlider .sliderCircleContainer .sliderCircle").get(b)).prevAll().last().addClass("highlight")}if(d!=undefined){$("#topHomeSlider .sliderCircleContainer .sliderCircle").removeClass("highlight");var a=c.next().attr("data-sliderid");$($("#topHomeSlider .sliderCircleContainer .sliderCircle").get(a)).addClass("highlight")}c.animate({marginLeft:"-"+(100/e)+"%"},{duration:800,easing:"linear",complete:function(){$(this).css("margin-left",0);$("#topHomeSlider .homeSlider").append(c.get(0));IniteditMusic.page.home.slider.config.sliderInterval=setTimeout(IniteditMusic.page.home.slider.sliderMove,IniteditMusic.page.home.slider.config.sliderStayTime)}})},sliderMoveAt:function(a){a=parseInt(a);clearInterval(IniteditMusic.page.home.slider.config.sliderInterval);var g=$("#topHomeSlider .homeSlider > .sliderItem").length;var e=$("#topHomeSlider  .sliderCircle.highlight");var d=e.attr("data-circleid");d=parseInt(d);var c=Math.abs((d-a));if(d>a){c=g-(Math.abs((d-a)))}$("#topHomeSlider  .sliderCircle").removeClass("highlight");for(var b=0;b<c;b++){setTimeout(this.moveFirstElement,b*200)}setTimeout(function(){$($("#topHomeSlider  .sliderCircle").get(a)).addClass("highlight");IniteditMusic.page.home.slider.config.sliderInterval=setTimeout(IniteditMusic.page.home.slider.sliderMove,IniteditMusic.page.home.slider.config.sliderStayTime)},(c+1)*200)},moveFirstElement:function(){var b=$("#topHomeSlider .homeSlider > .sliderItem").length;var a=$("#topHomeSlider .homeSlider > .sliderItem:first-child");a.animate({marginLeft:"-"+(100/b)+"%"},{duration:180,easing:"linear",complete:function(){$(this).css("margin-left",0);$("#topHomeSlider .homeSlider").append(a.get(0))}})}}}},storage:{config:{keys:{volume:"volume",repeat:"repeat",waveformType:"waveformType"},},init:function(){if(this.local.get(this.config.keys.volume)!=null){IniteditMusic.player.config.volume.init=this.local.get(this.config.keys.volume)}if(this.local.get(this.config.keys.repeat)!=null){IniteditMusic.player.config.repeat=this.local.get(this.config.keys.repeat)}if(this.local.get(this.config.keys.waveformType)!=null){IniteditMusic.player.config.waveformType=this.local.get(this.config.keys.waveformType)}},local:{config:{myBool:"true"},set:function(a,b){if(typeof(Storage)!=="undefined"){localStorage.setItem(a,b);return true}else{return null}},get:function(a){if(typeof(Storage)!=="undefined"){return localStorage.getItem(a)}else{return null}},setVolume:function(a){this.set(IniteditMusic.storage.config.keys.volume,a)},getVolume:function(){var a=this.get(IniteditMusic.storage.config.keys.volume);if(a!=null){return parseInt(a*IniteditMusic.player.config.volume.max)}else{return IniteditMusic.player.config.volume.init}},setRepeat:function(a){this.set(IniteditMusic.storage.config.keys.repeat,a)},getRepeat:function(){var a=this.get(IniteditMusic.storage.config.keys.repeat);if(a!=null){return a==this.config.myBool}else{return IniteditMusic.player.config.repeat}},setWaveformType:function(a){this.set(IniteditMusic.storage.config.keys.waveformType,a)},getWaveformType:function(){var a=this.get(IniteditMusic.storage.config.keys.waveformType);if(a!=null){return parseInt(a)}else{return IniteditMusic.player.waveform.config.defaultType}},}},search:{config:{searchDialogInterval:null,intervalTime:50},onClickShowSearchDialog:function(){$("#searchDialogBoxContainer").fadeIn("fast",function(){$("#main").hide()});$(window).on("keyup",this.hideSearchDialogShortcut)},onClickHideSearchDialog:function(){$("#main").show();$("#searchDialogBoxContainer").fadeOut()},hideSearchDialogShortcut:function(a){if(a.keyCode==27){$(window).off("keyup",IniteditMusic.search.hideSearchDialogShortcut);IniteditMusic.search.onClickHideSearchDialog()}},searchDialogInputResult:function(){var a=$("#searchDialogInput").val();if(a.length!=0){$.ajax({type:"POST",url:"/ajax/search/getSearchDialogResult",data:{search:a},dataType:"json",beforeSend:function(b){$("#searchDialogMainContentLoading").slideDown("fast")},success:function(b){IniteditMusic.recentObject.response=b;$("#searchDialogMainContent").html(b.data);IniteditMusic.helper.percessDownloadedMusicItem(b,IniteditMusic.recentMusic.searchMusic);$("#searchDialogBoxContainer .stopPropagation").on("click",IniteditMusic.helper.stopPropagationAndPreventDefault);$("#searchDialogBoxContainer  a").not(".linkDefault").click(IniteditMusic.helper.anchorClick);$("#searchDialogBoxContainer  a").not(".linkDefault").click(function(){IniteditMusic.search.onClickHideSearchDialog()});$("#searchDialogMainContentLoading").slideUp("fast")},failure:function(b){if(IniteditMusic.config.showError){$("body").append("<div>"+b+"</div>")}IniteditMusic.recentObject.response=b},error:function(b){if(IniteditMusic.config.showError){$("body").append("<div>"+b.responseText+"</div>")}console.log(b)},})}},onChangeSearchDialogInput:function(){if(IniteditMusic.search.config.searchDialogInterval!=null){clearInterval(IniteditMusic.search.config.searchDialogInterval)}IniteditMusic.search.config.searchDialogInterval=setTimeout(this.searchDialogInputResult,this.config.intervalTime)}},mobile:{menu:{onClickShowTopMenu:function(){$("#topMenuItems").html($(".settingMenu").prop("outerHTML"));$("#topMenuItems a").on("click",IniteditMusic.helper.anchorClick);$("#topMenuItems a").on("click",IniteditMusic.mobile.menu.onClickHideTopMenu);$("#topMenuContent").slideDown()},onClickHideTopMenu:function(){$("#topMenuContent").slideUp()},}}};$(document).ready(IniteditMusic.init);$(document).ready(function(){});